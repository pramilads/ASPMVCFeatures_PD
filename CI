<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<div class="table-responsive">

  <table mat-table [dataSource]="sortedEmployeeList" matSort class="mat-elevation-z8">
    <ng-container matColumnDef="select">
      <th mat-header-cell *matHeaderCellDef [attr.rowspan]="2" style="width: 70px;text-align: center;">
        Crew <br>Selection
      </th>
      <td mat-cell *matCellDef="let row" style="text-align: center;">
        <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(row) : null"
          [checked]="selection.isSelected(row)">
        </mat-checkbox>
      </td>
    </ng-container>

    <ng-container matColumnDef="headquarter">
      <th mat-header-cell *matHeaderCellDef mat-sort-header [attr.rowspan]="2" class="width-120"> Headquarters </th>
      <td mat-cell *matCellDef="let element"> {{element.headquarter}} </td>
    </ng-container>

    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef mat-sort-header [attr.rowspan]="2" class="width-120"> Employee Name </th>
      <td mat-cell *matCellDef="let element; let i = index"> {{element.name}}
        <span matTooltip="Edit Employee">
          <mat-icon style="font-size: 9px; cursor: pointer;  color: #3596dc;" aria-label="Edit Employee"
            (click)="editEmployee(i)">edit
          </mat-icon>
        </span>
      </td>
    </ng-container>

    <ng-container matColumnDef="employeeType">
      <th mat-header-cell *matHeaderCellDef mat-sort-header [attr.rowspan]="2" class="width-120"> Employee Type </th>
      <td mat-cell *matCellDef="let element"> {{element.employeeType}} </td>
    </ng-container>

    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef mat-sort-header [attr.rowspan]="2" style="width: 70px;text-align: center;">
        Status </th>
      <td mat-cell *matCellDef="let element"> {{element.status}} </td>
    </ng-container>

    <ng-container matColumnDef="No">
      <th mat-header-cell *matHeaderCellDef [attr.colspan]="7" style="width: 455px;">Capacity (Shift Hours)</th>
      <!-- This column doesn't generate <td> items, so no need to add a definition for them -->
    </ng-container>

    <ng-container matColumnDef="mon">
      <th mat-header-cell *matHeaderCellDef style="width: 60px;"> Mon </th>
      <td mat-cell *matCellDef="let element">
        {{ validateData(element.mon)}}
      </td>
    </ng-container>

    <ng-container matColumnDef="tues">
      <th mat-header-cell *matHeaderCellDef style="width: 60px;"> Tue </th>
      <td mat-cell *matCellDef="let element"> {{validateData(element.tues)}} </td>
    </ng-container>

    <ng-container matColumnDef="wed">
      <th mat-header-cell *matHeaderCellDef style="width: 60px;"> Wed </th>
      <td mat-cell *matCellDef="let element"> {{validateData(element.wed)}}</td>
    </ng-container>

    <ng-container matColumnDef="thur">
      <th mat-header-cell *matHeaderCellDef style="width: 60px;"> Thur </th>
      <td mat-cell *matCellDef="let element"> {{validateData(element.thur)}} </td>
    </ng-container>

    <ng-container matColumnDef="fri">
      <th mat-header-cell *matHeaderCellDef style="width: 60px;"> Fri </th>
      <td mat-cell *matCellDef="let element"> {{validateData(element.fri)}} </td>
    </ng-container>

    <ng-container matColumnDef="sat">
      <th mat-header-cell *matHeaderCellDef style="width: 60px;"> Sat </th>
      <td mat-cell *matCellDef="let element"> {{validateData(element.sat)}} </td>
    </ng-container>

    <ng-container matColumnDef="sun">
      <th mat-header-cell *matHeaderCellDef style="width: 71px;"> Sun </th>
      <td mat-cell *matCellDef="let element"> {{validateData(element.sun)}} </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="['select','headquarter','name','employeeType', 'status', 'No']"></tr>
    <tr mat-header-row *matHeaderRowDef="['mon', 'tues', 'wed','thur','fri','sat','sun']"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
</div>

<div class="row">
  <div class="col-md-12">
    <div class="form-group row">
      <br>
      <br>
      <div>
        <mat-paginator #paginator class="pagination" [length]="length" [pageSize]="pageSize"
          [pageSizeOptions]="pageSizeOptions" showFirstLastButtons>
        </mat-paginator>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-12 center">
    <div>
      <!-- <button class="btn btn-primary btn-sm" (click)="dataSelection()">Form Crew</button> -->
      <button class="btn btn-primary btn-sm" (click)="showDialogData()">Form Crew</button>
    </div>
  </div>
</div>

<div class="row mt-4">
  <div class="col-md-12">
    <div *ngIf="displayCrewCompostionTable">
      <crew-composition [allCrewList]="crewList" [data]="crewMemberList" [allEmployees]="allEmployees">
      </crew-composition>
    </div>
  </div>
</div>







------------------------------



import { SchedulerService } from 'src/app/core/services/scheduler.service';
import { Component, ViewChild, EventEmitter, Input, OnInit, Output, SimpleChanges } from '@angular/core';
import {
  NgbModal,
  NgbModalOptions,
  ModalDismissReasons,
} from '@ng-bootstrap/ng-bootstrap';

import { EmployeeEditComponent } from '../employee-edit/employee-edit.component';
import { CrewWorkEventComponent } from '../crew-work-event/crew-work-event.component'
import { SelectionModel } from '@angular/cdk/collections';
import { MatTableDataSource } from '@angular/material/table';
import { MatSort } from '@angular/material/sort';
import { MatPaginator } from '@angular/material/paginator';
import { NgxSpinnerService } from 'ngx-spinner';
import { MatDialog, MatDialogConfig } from '@angular/material/dialog';
import { DatePipe } from '@angular/common'

export interface PeriodicElement {
  headquarter: string;
  name: string;
  employeeType: string;
  status: string;
  mon: string;
  tues: string;
  wed: string;
  thur: string;
  fri: string;
  sat: string;
  sun: string;
}

@Component({
  selector: 'app-crew-info',
  templateUrl: 'crew-info.component.html',
})

export class CrewInfoComponent implements OnInit {
  displayedColumns: string[] = ['select', 'headquarter', 'name', 'employeeType', 'status', 'mon', 'tues', 'wed', 'thur', 'fri', 'sat', 'sun'];
  secondDisplayedColumns: string[] = ['select', 'name', 'mon', 'tues', 'wed', 'thur', 'fri', 'sat', 'sun'];
  @Input() crewList: any = [];
  @Input() empResp: any;
  @Input() crewListDisplay: any = [];


  workforceData = [];

  crewMemberList = [];
  membersDetails = [];
  memShiftDetails = [];
  shiftDetails = [];
  empIdList = [];

  TruckIdList = [];
  crewTypeList = [];
  CrewLeadList = [];
  HeadquaterList = [];
  WmcList = [];
  dropDownData: any;

  //*** Sorting ***//
  @ViewChild(MatSort, { static: true }) sort: MatSort;

  //*** MatPaginator Starts ***//
  length: number;
  pageSize: number = 50;
  nextPageLabel: String = "Page Size";
  pageSizeOptions = [10, 20, 30, 40, 50, 100, 200, 300, 400, 500];
  @ViewChild(MatPaginator, { static: true }) paginator: MatPaginator;
  //*** MatPaginator Ends ***//

  sortedEmployeeList = new MatTableDataSource<PeriodicElement>();
  @Output() outputEmployeeList = new EventEmitter<any>();

  formCrewDisabled: boolean = true;
  selection = new SelectionModel<PeriodicElement>(true, []);
  selectedEmployees = [];
  selectedList = [];
  selectedDialogObj = {};
  displayCrewCompostionTable = false;
  allEmployees = [];


  constructor(private modalService: NgbModal, private schedulerService: SchedulerService,
    private spinner: NgxSpinnerService, private dialog: MatDialog, private datePipe: DatePipe
  ) { }

  ngAfterViewInit() {
    this.sortedEmployeeList.paginator = this.paginator;
    this.sortedEmployeeList.sort = this.sort;
  }

  ngOnInit(): void {
    this.getCrewTypesForDropDowns();

    this.workforceData = JSON.parse(localStorage.getItem('workforce'));
    this.workforceData['DateFrom'] = this.datePipe.transform(this.workforceData['DateFrom'], 'yyyy-MM-dd');
    this.getExistingCrews(this.workforceData);
    // console.log("this.crewList....." + JSON.stringify(this.crewList));

    this.crewList.map(element => {
      this.TruckIdList.push(element.id);
      this.HeadquaterList.push(element.headquarter);
      this.WmcList.push(element.wmc);
      this.CrewLeadList.push(element.name);
      let empObj = {
        label: element.name,
        value: element.name
      }
      this.allEmployees.push(empObj);
    });
    this.sortedEmployeeList = new MatTableDataSource(this.crewList);
    this.pageSize = this.crewList.length;
    this.sortedEmployeeList.sort = this.sort;
    this.sortedEmployeeList.paginator = this.paginator;
    this.sortedEmployeeList.paginator._intl.itemsPerPageLabel = "Page Size: ";
  }

  ngOnChanges(changes: SimpleChanges) {
    this.sortedEmployeeList = changes.crewList?.currentValue;
  }

  getCrewTypesForDropDowns() {
    this.schedulerService.GetCrewTypes().subscribe(
      (res) => {
        this.dropDownData = res.dropdownDetails;
        res['dropdownDetails'].map(obj => {
          this.crewTypeList.push(obj);
        })
      }
    );
  }

  editEmployee(ind): void {
    let empId = this.sortedEmployeeList['filteredData'][ind]['id']
    const modalOptions: NgbModalOptions = {
      size: 'lg',
      keyboard: false,
      backdrop: 'static',
    };
    const modalRef = this.modalService.open(
      EmployeeEditComponent,
      modalOptions
    );
    const empInfo = JSON.parse(JSON.stringify(this.crewList)); // get a copy of employee list
    modalRef.componentInstance.inputEmployeeInfo = empInfo.filter(
      (emp) => emp.id === empId
    )[0];

    modalRef.result.then(
      (resolveReason) => {
        if (resolveReason === 'save') {
          this.outputEmployeeList.emit();
        } else if (resolveReason === 'cancel') {
          alert('do nothing');
        }
      },
      (rejectReason) => {
        alert(`Dismissed ${this.getDismissReason(rejectReason)}`);
      }
    );
  }

  private getDismissReason(reason: any): string {
    if (reason === ModalDismissReasons.ESC) {
      return 'by pressing ESC';
    } else if (reason === ModalDismissReasons.BACKDROP_CLICK) {
      return 'by clicking on a backdrop';
    } else {
      return `with: ${reason}`;
    }
  }

  valSecData(getValue) {
    var empty = [];
    var timeList = [];
    var timeObj = {};
    var returnList = [];
    if (getValue !== null) {
      // var value = getValue.split(">")
      var value = getValue.split(",");
      for (let time of value) {
        timeList = [];
        timeObj = {};
        timeList = time.split("_");
        timeObj = {
          "time": timeList[0],
          "CrewEventID": timeList[1]
        }

        // timeObj['time'] = timeList[0];
        // timeObj['CrewEventID'] = timeList[1];
        returnList.push(timeObj);
      }

      return returnList;
    }
    else {
      return empty;
    }
  }

  validateData(getValue) {
    var value = getValue.replace(/<\/n>/g, " ")

    // var value = getValue.replace(/,/g, " ")
    return value
  }

  showDialogData() {
    if (this.selection.selected.length > 1) {
      var getObj = {};
      getObj['employeeList'] = [];
      getObj['employeeData'] = [];
      getObj['TruckIdList'] = this.TruckIdList;
      getObj['crewTypeList'] = this.crewTypeList;
      getObj['HeadquaterList'] = this.HeadquaterList;

      this.selection.selected.map(item => {
        getObj['employeeList'].push(item.name);
        getObj['employeeData'].push(item);
      })

      const dialogConfig = new MatDialogConfig();
      dialogConfig.disableClose = true;
      dialogConfig.autoFocus = true;
      dialogConfig.width = '450px';
      dialogConfig.height = '600px';
      dialogConfig.data = {
        id: 1,
        type: 'dialog',
        title: 'Crew Types',
        formData: getObj,
      };
      const confirmDialog = this.dialog.open(CrewWorkEventComponent, dialogConfig);
      confirmDialog.afterClosed().subscribe(result => {
        if (result) {
          this.spinner.show();

          this.saveFormCrewInfo(result['data']);
          console.log("Saved result..." + result);

          this.selectedDialogObj = Object.assign({}, result['formdata']);
          //this.dataSelection();
        }
        if (!result) {
          this.selection.clear();
        }
      });
    }
    else {
      alert("Please select at least 2 employees");
    }
  }

  saveFormCrewInfo(data) {
    this.schedulerService.saveFormCrewInfo(data).subscribe(
      (res) => {
        this.getExistingCrews(this.workforceData);
        this.spinner.hide();
      }
    )
  }

  getExistingCrews(data) {
    var headquarterIds = "";
    var ind = 0;
    var dataLength = data.HeadquarterId.length;
    for (let id of data.HeadquarterId) {
      ind = ind + 1;
      headquarterIds += id;

      if (ind !== dataLength) {
        headquarterIds += ",";
      }
    }
    var dateFrom = this.datePipe.transform(data.DateFrom, 'M/dd/yy');

    var Data = {
      "WeekOf": dateFrom,
      "EnergyType": data.EnergyTypeId,
      "HeadquarterIds": headquarterIds
    };

    this.schedulerService.getExistingCrews(Data).subscribe(
      (res) => {
        this.membersDetails = res['membersDetails'];
        this.shiftDetails = res['shiftDetails'];
        var CrewId = 0;

        for (let sObj of this.shiftDetails) {
          CrewId = CrewId + 1;
          this.combineMemberdetails(sObj, CrewId);
        }
      }
    )
  }

  combineMemberdetails(getShiftObj, curInd) {
    var shiftTotal = this.shiftDetails.length;
    var nextStep = false;
    var currentId = 0;
    for (let sKey in getShiftObj) {
      for (let mObj of this.membersDetails) {
        if (mObj['is_Crew_Lead'] === true && mObj['crew_Id'] === getShiftObj['crewId']) {
          mObj[sKey] = getShiftObj[sKey];
        }
      }
    }

    nextStep = true;
    if (shiftTotal === curInd) {
      for (let sObj of this.shiftDetails) {
        currentId = currentId + 1;
        this.combineMemebers(sObj['crewId'], currentId);
      }
    }
  }

  combineMemebers(getId, idIndex) {
    var tempList = [];
    var totalShift = this.shiftDetails.length;

    for (let mObject of this.membersDetails) {
      if (getId === mObject['crew_Id']) {
        tempList.push(mObject);
      }
    }

    this.dataSelection(tempList);
  }

  dataSelection(getCrew) {
    var copyList = [];
    var leadIndex = 0;

    this.selectedList = Object.assign([], getCrew);
    copyList = Object.assign([], getCrew);

    for (let i = 0; i < copyList.length; i++) {
      if (copyList[i]['is_Crew_Lead'] === true) {
        leadIndex = i;
        this.arraymove(this.selectedList, leadIndex, 0);
      }
    }

    this.selection.clear();
  }

  arraymove(arr, fromIndex, toIndex) {
    var element = arr[fromIndex];
    arr.splice(fromIndex, 1);
    arr.splice(toIndex, 0, element);
    this.selectedList = Object.assign([], arr);
    //this.crewMemberList.push(arr);
    // if (this.shiftDetails.length === this.crewMemberList.length) {
    //   this.displayCrewCompostionTable = true;
    // }

    this.logSelection(arr);
  }

  logSelection(getArray) {
    let Table = [];
    var replaceObj = {};

    if (getArray.length > 1) {
      for (let s of getArray) {
        // var originalObj = s;
        replaceObj = Object.assign({}, s);
        for (let key in replaceObj) {
          if (key === "saturdayShiftDetails" || key === "mondayShiftDetails" || key === "tuesdayShiftDetails" || key === "wednesdayShiftDetails"
            || key === "thursdayShiftDetails" || key === "fridayShiftDetails" || key === "sundayShiftDetails") {
            let obj = this.valSecData(replaceObj[key]); //received list
            // var tempObj = [];
            // for (let ind of obj) {
            //   if (ind !== "") {
            //     let indKey = ind.substring(
            //       23 + 1, 33
            //     );
            //     tempObj.push(indKey);
            //   }
            // }
            replaceObj[key] = obj;

          }
        }
        Table.push(replaceObj);
      };
      // Table['crewType'] = this.selectedDialogObj['crewType'];
      // Table['truckId'] = this.selectedDialogObj['truckId'];
      // Table['crewLeadName'] = this.selectedDialogObj['crewLead'];
      // Table['headquarter'] = this.selectedDialogObj['selectedHQ'];
      console.log(this.shiftDetails.length + ".." + this.crewMemberList.length);
      this.crewMemberList.push(Table);

      if (this.shiftDetails.length === this.crewMemberList.length) {
        this.displayCrewCompostionTable = true;
      }
    }
  }

  checkEmployees() {
    var nextStep = false;
    // console.log(this.selectedEmployees);
    // console.log(this.selection.selected);
    let count = 0;
    this.selectedEmployees.map((name) => {
      if (name['selectedEmps']) {
        count = 0;
        this.selection.selected.map(obj => {
          name['selectedEmps'].find((key) => {
            if (key === obj.name) {
              count = count + 1
            }
          })
        })
      }
      console.log(count)
      if (count === this.selection.selected.length && name['selectedEmps'].length === this.selection.selected.length) { nextStep = true }
    })
    console.log("this.selection.selected...." + this.selection.selected);
    if (!nextStep) {
      this.showDialogData();
    } else {
      alert("This team Already exists!")
    }
  }
}
